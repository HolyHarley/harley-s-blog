---
import Layout from "../../layouts/Layout.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
    const allPosts = await getCollection("blog");
    const uniqueTags = [
        ...new Set(allPosts.map((post) => post.data.tags).flat()),
    ].filter((tag) => !!tag);

    return uniqueTags.map((tag) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.tags?.includes(tag || ""),
        );
        return {
            params: { tag },
            props: { posts: filteredPosts },
        };
    });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<Layout title={tag as string}>
    <div class="container" style="padding: 4rem 1.5rem;">
        <h1 class="page-title">#{tag}</h1>
        <div class="grid">
            {posts.map((post) => <PostCard post={post} />)}
        </div>
    </div>
</Layout>

<style>
    .page-title {
        font-size: 2.5rem;
        margin-bottom: 2rem;
        text-align: center;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }
</style>
